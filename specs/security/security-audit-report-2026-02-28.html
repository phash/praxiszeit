<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PraxisZeit – Sicherheits-Audit-Bericht | 2026-02-28</title>
<style>
  :root {
    --bg: #0f1117;
    --surface: #1a1d27;
    --surface2: #21253a;
    --border: #2d3250;
    --text: #e2e8f0;
    --muted: #8892b0;
    --accent: #64ffda;
    --critical: #ff4d4d;
    --critical-bg: rgba(255,77,77,0.12);
    --high: #ff8c00;
    --high-bg: rgba(255,140,0,0.12);
    --medium: #ffd700;
    --medium-bg: rgba(255,215,0,0.10);
    --low: #00bfff;
    --low-bg: rgba(0,191,255,0.10);
    --info: #a9b4c8;
    --info-bg: rgba(169,180,200,0.10);
    --positive: #00e676;
    --positive-bg: rgba(0,230,118,0.10);
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
    background: var(--bg);
    color: var(--text);
    line-height: 1.65;
  }
  a { color: var(--accent); text-decoration: none; }
  a:hover { text-decoration: underline; }

  /* ─── Layout ───────────────────────────────────────── */
  .wrapper { max-width: 1200px; margin: 0 auto; padding: 40px 24px; }
  .two-col { display: grid; grid-template-columns: 220px 1fr; gap: 32px; align-items: start; }
  @media(max-width:800px){ .two-col { grid-template-columns: 1fr; } }

  /* ─── TOC Sidebar ──────────────────────────────────── */
  .toc {
    position: sticky;
    top: 24px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 20px;
  }
  .toc h3 { font-size: .8rem; text-transform: uppercase; letter-spacing: .08em; color: var(--muted); margin-bottom: 12px; }
  .toc ul { list-style: none; }
  .toc li { margin-bottom: 6px; }
  .toc a { font-size: .82rem; color: var(--muted); }
  .toc a:hover { color: var(--accent); text-decoration: none; }
  .toc .section-link { color: var(--text); font-weight: 600; font-size: .85rem; margin-top: 10px; display: block; }

  /* ─── Header ───────────────────────────────────────── */
  .report-header {
    background: linear-gradient(135deg, #12142b 0%, #1a2040 100%);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 40px;
    margin-bottom: 32px;
  }
  .report-header h1 { font-size: 2rem; color: var(--accent); margin-bottom: 6px; }
  .report-header .subtitle { color: var(--muted); font-size: .95rem; }
  .meta-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px,1fr)); gap: 16px; margin-top: 28px; }
  .meta-item { background: var(--surface2); border-radius: 10px; padding: 14px 18px; }
  .meta-item .label { font-size: .72rem; text-transform: uppercase; letter-spacing: .06em; color: var(--muted); margin-bottom: 4px; }
  .meta-item .value { font-size: 1.1rem; font-weight: 700; }

  /* ─── Sections ─────────────────────────────────────── */
  section { margin-bottom: 48px; scroll-margin-top: 80px; }
  h2 {
    font-size: 1.4rem;
    border-bottom: 2px solid var(--border);
    padding-bottom: 10px;
    margin-bottom: 24px;
    color: var(--accent);
  }
  h3 { font-size: 1.05rem; color: var(--text); margin: 20px 0 8px; }

  /* ─── Severity Badges ──────────────────────────────── */
  .badge {
    display: inline-block;
    padding: 3px 10px;
    border-radius: 20px;
    font-size: .73rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: .06em;
    white-space: nowrap;
  }
  .badge-critical { background: var(--critical-bg); color: var(--critical); border: 1px solid var(--critical); }
  .badge-high     { background: var(--high-bg);     color: var(--high);     border: 1px solid var(--high); }
  .badge-medium   { background: var(--medium-bg);   color: var(--medium);   border: 1px solid var(--medium); }
  .badge-low      { background: var(--low-bg);       color: var(--low);       border: 1px solid var(--low); }
  .badge-info     { background: var(--info-bg);     color: var(--info);     border: 1px solid var(--info); }

  /* ─── Risk Scores ──────────────────────────────────── */
  .score-block { display: flex; align-items: center; gap: 20px; margin-bottom: 28px; }
  .score-circle {
    width: 90px; height: 90px; border-radius: 50%;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    border: 3px solid;
    flex-shrink: 0;
  }
  .score-circle.medium { border-color: var(--medium); color: var(--medium); }
  .score-circle .num { font-size: 1.8rem; font-weight: 800; }
  .score-circle .den { font-size: .7rem; color: var(--muted); }
  .score-text p { margin-bottom: 6px; font-size: .9rem; }

  /* ─── Stats ────────────────────────────────────────── */
  .stats-row { display: flex; gap: 14px; flex-wrap: wrap; margin-bottom: 24px; }
  .stat-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 16px 22px;
    text-align: center;
    min-width: 90px;
  }
  .stat-card .num { font-size: 2rem; font-weight: 800; }
  .stat-card .lbl { font-size: .72rem; color: var(--muted); text-transform: uppercase; letter-spacing: .04em; }
  .stat-card.c .num { color: var(--critical); }
  .stat-card.h .num { color: var(--high); }
  .stat-card.m .num { color: var(--medium); }
  .stat-card.l .num { color: var(--low); }
  .stat-card.i .num { color: var(--info); }

  /* ─── Findings Overview Table ──────────────────────── */
  .table-wrap { overflow-x: auto; }
  table { width: 100%; border-collapse: collapse; font-size: .85rem; }
  th {
    background: var(--surface2);
    padding: 10px 14px;
    text-align: left;
    border-bottom: 2px solid var(--border);
    font-size: .75rem;
    text-transform: uppercase;
    letter-spacing: .05em;
    color: var(--muted);
    white-space: nowrap;
  }
  td { padding: 10px 14px; border-bottom: 1px solid var(--border); vertical-align: top; }
  tr:last-child td { border-bottom: none; }
  tr:hover td { background: var(--surface2); }
  .id-cell { font-family: monospace; font-size: .8rem; color: var(--accent); }

  /* ─── Finding Cards ────────────────────────────────── */
  .finding {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 14px;
    margin-bottom: 28px;
    overflow: hidden;
    scroll-margin-top: 80px;
  }
  .finding-header {
    display: flex;
    align-items: flex-start;
    gap: 16px;
    padding: 20px 24px;
    border-bottom: 1px solid var(--border);
  }
  .finding-header.critical { border-left: 4px solid var(--critical); }
  .finding-header.high     { border-left: 4px solid var(--high); }
  .finding-header.medium   { border-left: 4px solid var(--medium); }
  .finding-header.low      { border-left: 4px solid var(--low); }
  .finding-header.info     { border-left: 4px solid var(--info); }
  .finding-id { font-family: monospace; font-size: .85rem; color: var(--muted); }
  .finding-title { font-size: 1.1rem; font-weight: 700; margin: 4px 0; }
  .finding-body { padding: 20px 24px; }
  .field { margin-bottom: 16px; }
  .field-label {
    font-size: .72rem; text-transform: uppercase; letter-spacing: .06em;
    color: var(--muted); margin-bottom: 4px; font-weight: 600;
  }
  .field-value { font-size: .9rem; }

  /* ─── Code Blocks ──────────────────────────────────── */
  pre {
    background: #0d1117;
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 16px;
    overflow-x: auto;
    font-size: .8rem;
    line-height: 1.55;
    font-family: 'Fira Code', 'Cascadia Code', Consolas, monospace;
    color: #c9d1d9;
    margin-top: 8px;
  }
  code {
    background: rgba(100,255,218,.08);
    border: 1px solid rgba(100,255,218,.15);
    border-radius: 4px;
    padding: 1px 6px;
    font-family: 'Fira Code', Consolas, monospace;
    font-size: .82em;
    color: var(--accent);
  }

  /* ─── Callouts ─────────────────────────────────────── */
  .callout {
    border-radius: 8px;
    padding: 14px 18px;
    margin: 12px 0;
    font-size: .88rem;
    border-left: 4px solid;
  }
  .callout-warn { background: var(--high-bg); border-color: var(--high); }
  .callout-info { background: var(--info-bg); border-color: var(--info); }
  .callout-good { background: var(--positive-bg); border-color: var(--positive); color: var(--positive); }

  /* ─── Remediation Roadmap ──────────────────────────── */
  .roadmap-item {
    display: flex;
    gap: 16px;
    margin-bottom: 14px;
    align-items: flex-start;
  }
  .roadmap-phase {
    background: var(--surface2);
    border-radius: 50%;
    width: 32px; height: 32px;
    display: flex; align-items: center; justify-content: center;
    font-weight: 700; font-size: .85rem;
    flex-shrink: 0;
  }
  .roadmap-phase.p1 { background: var(--critical-bg); color: var(--critical); border: 1px solid var(--critical); }
  .roadmap-phase.p2 { background: var(--high-bg);     color: var(--high);     border: 1px solid var(--high); }
  .roadmap-phase.p3 { background: var(--medium-bg);   color: var(--medium);   border: 1px solid var(--medium); }
  .roadmap-phase.p4 { background: var(--low-bg);      color: var(--low);      border: 1px solid var(--low); }

  /* ─── Positive Notes ───────────────────────────────── */
  .positive-item {
    display: flex;
    gap: 12px;
    align-items: flex-start;
    padding: 12px 0;
    border-bottom: 1px solid var(--border);
  }
  .positive-item:last-child { border-bottom: none; }
  .check { color: var(--positive); font-size: 1.2rem; flex-shrink: 0; margin-top: 1px; }

  /* ─── Print ────────────────────────────────────────── */
  @media print {
    body { background: #fff; color: #000; }
    .toc { display: none; }
    .two-col { grid-template-columns: 1fr; }
    pre { border: 1px solid #ccc; background: #f8f8f8; color: #000; }
  }
</style>
</head>
<body>
<div class="wrapper">

<!-- ═══════════════════════════════════════════════════════════
     HEADER
════════════════════════════════════════════════════════════ -->
<div class="report-header">
  <h1>PraxisZeit – Sicherheits-Audit-Bericht</h1>
  <div class="subtitle">Technischer Penetrationstest &amp; Code-Review | Vertraulich – Nur für interne Verwendung</div>
  <div class="meta-grid">
    <div class="meta-item"><div class="label">Datum</div><div class="value">2026-02-28</div></div>
    <div class="meta-item"><div class="label">Prüfer</div><div class="value">AppSec-Auditor (AI-Assisted)</div></div>
    <div class="meta-item"><div class="label">Version</div><div class="value">2.0</div></div>
    <div class="meta-item"><div class="label">Scope</div><div class="value">Full-Stack</div></div>
    <div class="meta-item"><div class="label">Stack</div><div class="value">React + FastAPI + PostgreSQL</div></div>
    <div class="meta-item"><div class="label">Letzter Audit</div><div class="value">2026-02-20</div></div>
  </div>
</div>

<div class="two-col">

<!-- ─── SIDEBAR ──────────────────────────────────────── -->
<nav class="toc">
  <h3>Inhaltsverzeichnis</h3>
  <ul>
    <li><a href="#exec-summary" class="section-link">1. Executive Summary</a></li>
    <li><a href="#methodology" class="section-link">2. Methodik</a></li>
    <li><a href="#overview-table" class="section-link">3. Findings-Übersicht</a></li>
    <li><a href="#findings" class="section-link">4. Detaillierte Findings</a></li>
    <li style="margin-left:10px"><a href="#vuln-001">VULN-001</a></li>
    <li style="margin-left:10px"><a href="#vuln-002">VULN-002</a></li>
    <li style="margin-left:10px"><a href="#vuln-003">VULN-003</a></li>
    <li style="margin-left:10px"><a href="#vuln-004">VULN-004</a></li>
    <li style="margin-left:10px"><a href="#vuln-005">VULN-005</a></li>
    <li style="margin-left:10px"><a href="#vuln-006">VULN-006</a></li>
    <li style="margin-left:10px"><a href="#vuln-007">VULN-007</a></li>
    <li style="margin-left:10px"><a href="#vuln-008">VULN-008</a></li>
    <li style="margin-left:10px"><a href="#vuln-009">VULN-009</a></li>
    <li style="margin-left:10px"><a href="#vuln-010">VULN-010</a></li>
    <li style="margin-left:10px"><a href="#vuln-011">VULN-011</a></li>
    <li style="margin-left:10px"><a href="#vuln-012">VULN-012</a></li>
    <li style="margin-left:10px"><a href="#vuln-013">VULN-013</a></li>
    <li style="margin-left:10px"><a href="#vuln-014">VULN-014</a></li>
    <li style="margin-left:10px"><a href="#vuln-015">VULN-015</a></li>
    <li><a href="#attack-chains" class="section-link">5. Angriffsketten</a></li>
    <li><a href="#roadmap" class="section-link">6. Remediation-Roadmap</a></li>
    <li><a href="#positives" class="section-link">7. Positive Controls</a></li>
  </ul>
</nav>

<!-- ─── MAIN CONTENT ─────────────────────────────────── -->
<main>

<!-- ═══════════════════════════════════════════════════
     1. EXECUTIVE SUMMARY
════════════════════════════════════════════════════ -->
<section id="exec-summary">
  <h2>1. Executive Summary</h2>

  <div class="score-block">
    <div class="score-circle medium">
      <div class="num">6.1</div>
      <div class="den">/10</div>
    </div>
    <div class="score-text">
      <p><strong>Gesamtrisiko-Bewertung: Mittel-Hoch</strong></p>
      <p>Die Anwendung hat seit dem letzten Audit (2026-02-20) erhebliche Sicherheitsverbesserungen erfahren. Kritische Altprobleme (Wildcard-CORS, Token-Revocation) wurden adressiert. Dieser Audit deckt <strong>15 neue Findings</strong> auf, darunter ein kritisches, drei hohe und acht mittlere Schwachstellen.</p>
      <p>Besonders besorgniserregend ist das Vorhandensein eines <strong>.env-Files mit Produktiv-Credentials</strong> im Projektverzeichnis sowie das Fehlen von Brute-Force-Schutz auf der TOTP-Verifikations-Route.</p>
    </div>
  </div>

  <div class="stats-row">
    <div class="stat-card c"><div class="num">1</div><div class="lbl">Kritisch</div></div>
    <div class="stat-card h"><div class="num">3</div><div class="lbl">Hoch</div></div>
    <div class="stat-card m"><div class="num">8</div><div class="lbl">Mittel</div></div>
    <div class="stat-card l"><div class="num">2</div><div class="lbl">Niedrig</div></div>
    <div class="stat-card i"><div class="num">1</div><div class="lbl">Informativ</div></div>
  </div>

  <div class="callout callout-warn">
    <strong>Kontext:</strong> PraxisZeit verarbeitet sensible Arbeitszeitdaten (Gesundheitsdaten im Sinne von DSGVO Art. 9 bei Krankenabwesenheiten) für Mitarbeiter einer Arztpraxis. Ein erfolgreicher Angriff kann arbeitsrechtliche Konsequenzen haben, Betriebsgeheimnisse offenlegen und DSGVO-Bußgelder auslösen.
  </div>
</section>

<!-- ═══════════════════════════════════════════════════
     2. METHODIK
════════════════════════════════════════════════════ -->
<section id="methodology">
  <h2>2. Methodik</h2>
  <p>Der Audit umfasste einen vollständigen <strong>White-Box Code-Review</strong> aller Quelldateien:</p>
  <ul style="margin: 12px 0 12px 24px; line-height: 2;">
    <li>Backend: <code>routers/</code>, <code>models/</code>, <code>schemas/</code>, <code>services/</code>, <code>middleware/auth.py</code>, <code>main.py</code>, <code>config.py</code>, alle Alembic-Migrationen</li>
    <li>Frontend: <code>pages/</code>, <code>components/</code>, <code>stores/authStore.ts</code>, <code>api/client.ts</code>, <code>App.tsx</code></li>
    <li>Infrastruktur: <code>docker-compose.yml</code>, <code>frontend/nginx.conf</code>, <code>backend/Dockerfile</code></li>
    <li>Konfiguration: <code>.env</code>, <code>.env.example</code>, <code>.gitignore</code></li>
    <li>Abgleich mit Findings des Audits vom 2026-02-20</li>
  </ul>
  <p>Prüfrahmen: <strong>OWASP Top 10 2021</strong>, <strong>OWASP API Security Top 10 2023</strong>, CWE, DSGVO/BDSG sowie anwendungsspezifische Business-Logic-Tests.</p>
</section>

<!-- ═══════════════════════════════════════════════════
     3. FINDINGS-ÜBERSICHT
════════════════════════════════════════════════════ -->
<section id="overview-table">
  <h2>3. Findings-Übersicht</h2>
  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Titel</th>
          <th>Severity</th>
          <th>CVSS</th>
          <th>CWE</th>
          <th>OWASP 2021</th>
          <th>Komponente</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td class="id-cell"><a href="#vuln-001">VULN-001</a></td>
          <td>Dev/Test-Credentials in .env-Datei (nur lokale Entwicklungsumgebung)</td>
          <td><span class="badge badge-info">Info</span></td>
          <td>N/A</td>
          <td>CWE-312</td>
          <td>A05 – Fehlkonfig.</td>
          <td><code>.env</code></td>
        </tr>
        <tr>
          <td class="id-cell"><a href="#vuln-002">VULN-002</a></td>
          <td>Kein Rate-Limiting auf TOTP-Setup- und TOTP-Verify-Endpunkten</td>
          <td><span class="badge badge-high">Hoch</span></td>
          <td>7.5</td>
          <td>CWE-307</td>
          <td>A07 – Auth-Fehler</td>
          <td><code>auth.py</code></td>
        </tr>
        <tr>
          <td class="id-cell"><a href="#vuln-003">VULN-003</a></td>
          <td>TOTP-Secret im Klartext in der API-Response exponiert</td>
          <td><span class="badge badge-high">Hoch</span></td>
          <td>7.2</td>
          <td>CWE-312</td>
          <td>A02 – Krypto-Fehler</td>
          <td><code>auth.py /totp/setup</code></td>
        </tr>
        <tr>
          <td class="id-cell"><a href="#vuln-004">VULN-004</a></td>
          <td>Refresh-Token in localStorage (paralleler Pfad)</td>
          <td><span class="badge badge-high">Hoch</span></td>
          <td>7.1</td>
          <td>CWE-922</td>
          <td>A02 – Krypto-Fehler</td>
          <td><code>authStore.ts</code></td>
        </tr>
        <tr>
          <td class="id-cell"><a href="#vuln-005">VULN-005</a></td>
          <td>Fehlende Paginierung – Admin-Routen laden unbegrenzt viele Datensätze</td>
          <td><span class="badge badge-medium">Mittel</span></td>
          <td>5.3</td>
          <td>CWE-400</td>
          <td>API5 – FLA</td>
          <td><code>admin.py</code>, <code>reports.py</code></td>
        </tr>
        <tr>
          <td class="id-cell"><a href="#vuln-006">VULN-006</a></td>
          <td>Inkonsistente Frontend-Passwort-Mindestlängen-Prüfung</td>
          <td><span class="badge badge-medium">Mittel</span></td>
          <td>5.0</td>
          <td>CWE-521</td>
          <td>A07 – Auth-Fehler</td>
          <td><code>Profile.tsx</code></td>
        </tr>
        <tr>
          <td class="id-cell"><a href="#vuln-007">VULN-007</a></td>
          <td>Fehlende HSTS-Header im Standard-Nginx-Deployment</td>
          <td><span class="badge badge-medium">Mittel</span></td>
          <td>5.4</td>
          <td>CWE-319</td>
          <td>A05 – Fehlkonfig.</td>
          <td><code>nginx.conf</code></td>
        </tr>
        <tr>
          <td class="id-cell"><a href="#vuln-008">VULN-008</a></td>
          <td>Grafana /grafana/api/live/ WebSocket ohne IP-Whitelist-Schutz</td>
          <td><span class="badge badge-medium">Mittel</span></td>
          <td>5.3</td>
          <td>CWE-284</td>
          <td>A01 – Broken Access</td>
          <td><code>nginx.conf</code></td>
        </tr>
        <tr>
          <td class="id-cell"><a href="#vuln-009">VULN-009</a></td>
          <td>Race Condition bei gleichzeitigem Einstempeln (clock-in)</td>
          <td><span class="badge badge-medium">Mittel</span></td>
          <td>4.8</td>
          <td>CWE-362</td>
          <td>A04 – Unsicheres Design</td>
          <td><code>time_entries.py</code></td>
        </tr>
        <tr>
          <td class="id-cell"><a href="#vuln-010">VULN-010</a></td>
          <td>Rollenwechsel über UserUpdate ohne Token-Invalidierung</td>
          <td><span class="badge badge-medium">Mittel</span></td>
          <td>4.9</td>
          <td>CWE-269</td>
          <td>A01 – Broken Access</td>
          <td><code>admin.py PUT /users/{id}</code></td>
        </tr>
        <tr>
          <td class="id-cell"><a href="#vuln-011">VULN-011</a></td>
          <td>Business-Logic: Urlaubsüberschuss-Warnung ohne Sperrmechanismus</td>
          <td><span class="badge badge-medium">Mittel</span></td>
          <td>4.3</td>
          <td>CWE-840</td>
          <td>A04 – Unsicheres Design</td>
          <td><code>absences.py</code></td>
        </tr>
        <tr>
          <td class="id-cell"><a href="#vuln-012">VULN-012</a></td>
          <td>Fehler-Traceback mit potenziell sensiblen Pfad-Informationen in DB gespeichert</td>
          <td><span class="badge badge-medium">Mittel</span></td>
          <td>4.3</td>
          <td>CWE-209</td>
          <td>A09 – Logging-Fehler</td>
          <td><code>error_log_service.py</code></td>
        </tr>
        <tr>
          <td class="id-cell"><a href="#vuln-013">VULN-013</a></td>
          <td>Fehlende server_tokens-Direktive in Nginx (Versions-Offenbarung)</td>
          <td><span class="badge badge-low">Niedrig</span></td>
          <td>3.1</td>
          <td>CWE-200</td>
          <td>A05 – Fehlkonfig.</td>
          <td><code>nginx.conf</code></td>
        </tr>
        <tr>
          <td class="id-cell"><a href="#vuln-014">VULN-014</a></td>
          <td>Dependency-Versionen als Globs ohne SHA-Pinning (Supply-Chain-Risiko)</td>
          <td><span class="badge badge-low">Niedrig</span></td>
          <td>3.7</td>
          <td>CWE-1357</td>
          <td>A06 – Veraltete Komponenten</td>
          <td><code>requirements.txt</code></td>
        </tr>
        <tr>
          <td class="id-cell"><a href="#vuln-015">VULN-015</a></td>
          <td>Admin-User-Erstellung ohne Überprüfung auf Passwort-Komplexität</td>
          <td><span class="badge badge-info">Informativ</span></td>
          <td>2.1</td>
          <td>CWE-521</td>
          <td>A07 – Auth-Fehler</td>
          <td><code>main.py lifespan</code></td>
        </tr>
      </tbody>
    </table>
  </div>
</section>

<!-- ═══════════════════════════════════════════════════
     4. DETAILLIERTE FINDINGS
════════════════════════════════════════════════════ -->
<section id="findings">
  <h2>4. Detaillierte Findings</h2>

  <!-- ─── VULN-001 ─────────────────────────────────── -->
  <div class="finding" id="vuln-001">
    <div class="finding-header" style="background: var(--info-bg); border-bottom: 1px solid var(--border);">
      <div>
        <div class="finding-id">VULN-001</div>
        <div class="finding-title">Dev/Test-Credentials in .env-Datei (ausschließlich lokale Entwicklungsumgebung)</div>
        <div style="margin-top:6px; display:flex; gap:8px; flex-wrap:wrap;">
          <span class="badge badge-info">Informational</span>
          <span style="font-size:.8rem;color:var(--muted);">CVSS N/A | CWE-312 | A05:2021</span>
        </div>
      </div>
    </div>
    <div class="finding-body">
      <div class="field">
        <div class="field-label">Betroffene Datei</div>
        <div class="field-value"><code>E:/claude/zeiterfassung/praxiszeit/.env</code></div>
      </div>
      <div class="field">
        <div class="field-label">Status</div>
        <div class="field-value" style="color: var(--positive); font-weight:600;">&#10003; Akzeptiertes Risiko – Nur lokale Entwicklungsumgebung</div>
      </div>
      <div class="field">
        <div class="field-label">Beschreibung</div>
        <div class="field-value">
          <p>Die <code>.env</code>-Datei enthält Credentials ausschließlich für die lokale Entwicklungs- und Testumgebung. Diese werden nicht in Produktion eingesetzt. Die Datei ist korrekt in <code>.gitignore</code> eingetragen und wird nicht ins Repository eingecheckt.</p>
          <p style="margin-top:8px;">Dieses Finding wird daher als <strong>Informational / Accepted Risk</strong> eingestuft und erfordert keine Sofortmaßnahme.</p>
        </div>
      </div>
      <div class="field">
        <div class="field-label">Hinweise für die Produktivumgebung</div>
        <div class="field-value">
          <ul style="margin: 10px 0 10px 24px;">
            <li>Sicherstellen, dass in der Produktivumgebung starke, zufällig generierte Passwörter verwendet werden.</li>
            <li>Produktiv-Credentials nicht in .env-Dateien speichern – stattdessen Secrets-Management einsetzen (z.B. Docker Secrets, HashiCorp Vault, Umgebungsvariablen des Deployment-Systems).</li>
            <li>Pre-commit Hook empfohlen, um versehentliches Einchecken von Credentials zu verhindern (z.B. <code>gitleaks</code>).</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- ─── VULN-002 ─────────────────────────────────── -->
  <div class="finding" id="vuln-002">
    <div class="finding-header high">
      <div>
        <div class="finding-id">VULN-002</div>
        <div class="finding-title">Fehlender Brute-Force-Schutz auf TOTP-Setup und TOTP-Verify</div>
        <div style="margin-top:6px; display:flex; gap:8px; flex-wrap:wrap;">
          <span class="badge badge-high">Hoch</span>
          <span style="font-size:.8rem;color:var(--muted);">CVSS 7.5 | CWE-307 | A07:2021</span>
        </div>
      </div>
    </div>
    <div class="finding-body">
      <div class="field">
        <div class="field-label">Betroffene Endpunkte</div>
        <div class="field-value"><code>POST /api/auth/totp/setup</code>, <code>POST /api/auth/totp/verify</code>, <code>DELETE /api/auth/totp/disable</code></div>
      </div>
      <div class="field">
        <div class="field-label">Technische Beschreibung</div>
        <div class="field-value">
          <p>Alle TOTP-Endpunkte sind nicht mit dem <code>@limiter.limit()</code>-Decorator von slowapi versehen. Ein Angreifer mit gültigem Access-Token kann:</p>
          <ul style="margin: 10px 0 10px 24px;">
            <li><strong>TOTP brute-forcen:</strong> Nach dem Login (mit gestohlenen Credentials) alle 1.000.000 6-stelligen TOTP-Codes durchprobieren. Ein TOTP-Code ist 30 Sekunden gültig; mit ±1 Window (valid_window=1) 90 Sekunden. Bei 10.000 Requests/Sekunde: alle Codes in &lt;2 Minuten prüfbar.</li>
            <li><strong>TOTP-Disable brute-forcen:</strong> Passwort-Verifikation auf <code>/totp/disable</code> ist ebenfalls unlimitiert – ein Angreifer kann Passwörter durchprobieren.</li>
          </ul>
          <p>Selbst wenn der Login per Rate-Limiting auf 5/min begrenzt ist, schützt dies nicht vor Angriffen auf TOTP-Endpunkte <em>nach</em> einem Login.</p>
        </div>
      </div>
      <div class="field">
        <div class="field-label">Proof of Concept</div>
        <pre>
# Angreifer hat gültigen Access-Token (z.B. von gestohlenen Credentials ohne TOTP)
# Neuer Versuch: TOTP-Setup + sofortiges Brute-Force des TOTP-Codes

for code in range(0, 1000000):
    r = requests.post(
        "https://praxis.example.com/api/auth/totp/verify",
        json={"code": f"{code:06d}"},
        headers={"Authorization": f"Bearer {stolen_token}"}
    )
    if r.status_code == 200:
        print(f"TOTP verifiziert! Code: {code:06d}")
        break  # 2FA aktiviert unter Angreiferkontrolle</pre>
      </div>
      <div class="field">
        <div class="field-label">Impact</div>
        <div class="field-value">Ein Angreifer kann 2FA auf ein fremdes Konto unter eigener Kontrolle aktivieren (Account-Takeover). Alternativ: bestehende 2FA deaktivieren via Brute-Force des Passworts auf <code>/totp/disable</code>.</div>
      </div>
      <div class="field">
        <div class="field-label">Empfehlung</div>
        <pre>
# backend/app/routers/auth.py

from app.core.limiter import limiter

@router.post("/totp/setup", response_model=TotpSetupResponse)
@limiter.limit("3/minute")   # ← HINZUFÜGEN
def totp_setup(request: Request, ...):
    ...

@router.post("/totp/verify", response_model=UserResponse)
@limiter.limit("5/minute")   # ← HINZUFÜGEN
def totp_verify(request: Request, ...):
    ...

@router.delete("/totp/disable", response_model=UserResponse)
@limiter.limit("3/minute")   # ← HINZUFÜGEN
def totp_disable(request: Request, ...):
    ...</pre>
        <p style="margin-top:10px;">Zusätzlich: Nach 5 fehlgeschlagenen TOTP-Versuchen den Account für 15 Minuten sperren (lockout-Counter in DB oder Redis).</p>
      </div>
    </div>
  </div>

  <!-- ─── VULN-003 ─────────────────────────────────── -->
  <div class="finding" id="vuln-003">
    <div class="finding-header high">
      <div>
        <div class="finding-id">VULN-003</div>
        <div class="finding-title">TOTP-Secret im Klartext in der API-Response</div>
        <div style="margin-top:6px; display:flex; gap:8px; flex-wrap:wrap;">
          <span class="badge badge-high">Hoch</span>
          <span style="font-size:.8rem;color:var(--muted);">CVSS 7.2 | CWE-312 | A02:2021</span>
        </div>
      </div>
    </div>
    <div class="finding-body">
      <div class="field">
        <div class="field-label">Betroffener Code</div>
        <div class="field-value"><code>backend/app/routers/auth.py</code>, Zeile 291–309 (<code>totp_setup</code>)</div>
      </div>
      <div class="field">
        <div class="field-label">Technische Beschreibung</div>
        <div class="field-value">
          <p>Die <code>/api/auth/totp/setup</code>-Route gibt das rohe TOTP-Secret als Klartext-String in der JSON-Response zurück:</p>
        </div>
      </div>
      <div class="field">
        <div class="field-label">Betroffener Code</div>
        <pre>
# auth.py, Zeile 302–308
secret = auth_service.generate_totp_secret()
current_user.totp_secret = secret
db.commit()

return TotpSetupResponse(
    otpauth_uri=auth_service.get_totp_uri(current_user.username, secret),
    secret=secret,    # ← TOTP-Secret im Klartext in der API-Response!
)</pre>
      </div>
      <div class="field">
        <div class="field-label">Angriffsszenario</div>
        <div class="field-value">
          <p>Das Secret wird über HTTPS übertragen und im Browser verarbeitet. Angriffsvektoren:</p>
          <ul style="margin: 10px 0 10px 24px;">
            <li><strong>Browser-Extension-Kompromittierung:</strong> Schädliche Extensions lesen API-Responses aus.</li>
            <li><strong>XSS:</strong> Eine XSS-Schwachstelle (auch in Third-Party-JS) kann den Secret exfiltrieren.</li>
            <li><strong>Proxy/MitM:</strong> Bei falscher TLS-Konfiguration oder auf kompromittierten Endgeräten (Unternehmens-CA) lesbar.</li>
            <li><strong>Logging:</strong> Wenn das Secret in Server-Logs landet (z.B. im error_log_service), ist es langfristig exponiert.</li>
          </ul>
          <p>Das TOTP-Secret ist das "Masterschlüssel"-Äquivalent für 2FA. Wer es kennt, kann beliebig lange gültige TOTP-Codes generieren, auch wenn das Passwort später geändert wird.</p>
        </div>
      </div>
      <div class="field">
        <div class="field-label">Impact</div>
        <div class="field-value">Dauerhafter Verlust der 2FA-Schutzwirkung. Angreifer kann sich jederzeit als der Benutzer authentifizieren, ohne das Passwort zu kennen.</div>
      </div>
      <div class="field">
        <div class="field-label">Empfehlung</div>
        <div class="field-value">
          <p>Das Zurückgeben des Secrets ist für QR-Code-Anzeige und manuellen Eintrag notwendig, aber nur einmalig beim Setup akzeptabel. Verbesserungen:</p>
          <pre>
# 1. Secret NUR beim initialen Setup zurückgeben (bereits so implementiert – gut)
# 2. Secret in DB verschlüsselt speichern (AEAD, z.B. Fernet / AES-GCM)
# 3. Secret NICHT in Error-Logs loggen – sicherstellen, dass _scrub_pii()
#    auch Base32-Strings erfasst (aktuell nur UUIDs und E-Mails)
# 4. Nach erfolgreichem totp/verify das Secret NICHT mehr zurückgebbar machen

# Zusatz: In TotpSetupResponse nur beim ersten /setup senden,
# nach totp/verify das Secret aus der DB-Antwort des users entfernen</pre>
        </div>
      </div>
    </div>
  </div>

  <!-- ─── VULN-004 ─────────────────────────────────── -->
  <div class="finding" id="vuln-004">
    <div class="finding-header high">
      <div>
        <div class="finding-id">VULN-004</div>
        <div class="finding-title">Refresh-Token in localStorage gespeichert (Frontend-Duplikat)</div>
        <div style="margin-top:6px; display:flex; gap:8px; flex-wrap:wrap;">
          <span class="badge badge-high">Hoch</span>
          <span style="font-size:.8rem;color:var(--muted);">CVSS 7.1 | CWE-922 | A02:2021</span>
        </div>
      </div>
    </div>
    <div class="finding-body">
      <div class="field">
        <div class="field-label">Betroffene Dateien</div>
        <div class="field-value"><code>frontend/src/stores/authStore.ts</code> (Zeilen 54–55, 88–89), <code>frontend/src/api/client.ts</code> (Zeile 35)</div>
      </div>
      <div class="field">
        <div class="field-label">Technische Beschreibung</div>
        <div class="field-value">
          <p>Das Backend speichert den Refresh-Token korrekt als HttpOnly-Cookie (Feature F-010). Jedoch speichert der Zustand-Store (<code>authStore.ts</code>) den Refresh-Token <em>zusätzlich</em> in <code>localStorage</code>, was das HttpOnly-Cookie-Sicherheitsmodell vollständig unterläuft:</p>
        </div>
      </div>
      <div class="field">
        <div class="field-label">Betroffener Code</div>
        <pre>
// authStore.ts – Zeilen 54-55 (login-Funktion)
localStorage.setItem('access_token', access_token);
localStorage.setItem('refresh_token', refresh_token);  // ← SICHERHEITSPROBLEM!
//                   ^^^^^^^^^^^^^^^ Token in localStorage = XSS-Angriffsziel

// authStore.ts – Zeilen 88-89 (setTokens-Funktion)
localStorage.setItem('access_token', accessToken);
localStorage.setItem('refresh_token', refreshToken);   // ← Ebenfalls problematisch

// api/client.ts – Zeile 35 (Response-Interceptor)
const refreshToken = localStorage.getItem('refresh_token'); // ← Liest aus localStorage</pre>
        <div class="callout callout-warn" style="margin-top:12px;">
          <strong>Problem:</strong> Das Backend gibt in der Login-Response kein <code>refresh_token</code>-Feld mehr zurück (<code>LoginResponse</code>-Schema hat es entfernt). Der Axios-Interceptor in <code>client.ts</code> liest es trotzdem aus localStorage. Das bedeutet: der Wert ist entweder aus einem alten Session-Cookie (dann leer/ungültig) oder die Frontend-Logik schlägt fehl. Die <code>setTokens()</code>-Funktion in authStore akzeptiert weiterhin einen <code>refreshToken</code>-Parameter – dies ist totes, aber potenziell gefährliches Code.
        </div>
      </div>
      <div class="field">
        <div class="field-label">Impact</div>
        <div class="field-value">Bei einer XSS-Schwachstelle kann ein Angreifer <code>localStorage.getItem('refresh_token')</code> aufrufen und den Token exfiltrieren. Ein gestohlener Refresh-Token erlaubt 7 Tage lang Access-Token-Erneuerung.</div>
      </div>
      <div class="field">
        <div class="field-label">Empfehlung</div>
        <pre>
// authStore.ts – Zeilen 54-55: refresh_token NICHT in localStorage speichern
// Das Backend-Cookie handelt dies. Nur access_token in Memory/localStorage.

login: async (username: string, password: string) => {
    const response = await apiClient.post('/auth/login', { username, password });
    const { access_token, user } = response.data;  // refresh_token kommt als Cookie!

    localStorage.setItem('access_token', access_token);
    // localStorage.setItem('refresh_token', refresh_token);  // ← ENTFERNEN

    set({ user, accessToken: access_token, isAuthenticated: true });
},

// api/client.ts – Refresh via Cookie, kein localStorage:
// Der /api/auth/refresh-Endpunkt liest das Cookie automatisch.
// Client.ts Interceptor muss nur POST /api/auth/refresh aufrufen,
// OHNE manuell einen refresh_token mitzusenden.</pre>
      </div>
    </div>
  </div>

  <!-- ─── VULN-005 ─────────────────────────────────── -->
  <div class="finding" id="vuln-005">
    <div class="finding-header medium">
      <div>
        <div class="finding-id">VULN-005</div>
        <div class="finding-title">Fehlende Paginierung – Unbegrenzte Datenmenge in Admin-Endpunkten</div>
        <div style="margin-top:6px; display:flex; gap:8px; flex-wrap:wrap;">
          <span class="badge badge-medium">Mittel</span>
          <span style="font-size:.8rem;color:var(--muted);">CVSS 5.3 | CWE-400 | API5:2023</span>
        </div>
      </div>
    </div>
    <div class="finding-body">
      <div class="field">
        <div class="field-label">Betroffene Endpunkte</div>
        <div class="field-value">
          <ul style="margin-left:20px; line-height: 2.1;">
            <li><code>GET /api/admin/users</code> – Alle Benutzer, keine Paginierung</li>
            <li><code>GET /api/admin/change-requests</code> – Alle Change-Requests</li>
            <li><code>GET /api/admin/audit-log</code> – Alle Audit-Log-Einträge</li>
            <li><code>GET /api/absences/team/upcoming</code> – Alle zukünftigen Abwesenheiten</li>
            <li><code>GET /api/admin/reports/sunday-summary</code> – Alle Einträge des Jahres pro User</li>
            <li><code>GET /api/admin/reports/compensatory-rest</code> – Iteriert über alle Einträge</li>
          </ul>
        </div>
      </div>
      <div class="field">
        <div class="field-label">Technische Beschreibung</div>
        <div class="field-value">
          <p>Die meisten Admin-Endpunkte laden alle Datensätze ohne Limit in den Arbeitsspeicher. Bei einer mittelgroßen Praxis mit 50 Mitarbeitern und 2 Jahren Betrieb können z.B. im Audit-Log über 100.000 Einträge entstehen. Ein Admin-Benutzer (legitim oder kompromittiert) kann diese Endpunkte frequentiert aufrufen und damit:</p>
          <ul style="margin: 10px 0 10px 24px;">
            <li>Datenbankverbindungen erschöpfen (jede Anfrage hält Verbindung offen bis alle Daten geliefert sind)</li>
            <li>Backend-RAM bis zur OOM-Grenze füllen</li>
            <li>Antwortzeiten drastisch erhöhen (DoS-ähnliches Verhalten)</li>
          </ul>
          <p>Die Error-Log-Endpunkte haben bereits ein <code>limit: int = Query(100, le=500)</code>, dies fehlt bei den anderen.</p>
        </div>
      </div>
      <div class="field">
        <div class="field-label">Proof of Concept</div>
        <pre>
# Nach 2 Jahren Betrieb: audit_log kann sehr groß sein
GET /api/admin/audit-log HTTP/1.1
# → Backend lädt alle TimeEntryAuditLog-Records ohne LIMIT
# → Potentiell 100k+ Rows in einer Query</pre>
      </div>
      <div class="field">
        <div class="field-label">Empfehlung</div>
        <pre>
# admin.py – list_audit_log
@router.get("/audit-log", response_model=List[AuditLogResponse])
def list_audit_log(
    ...
    limit: int = Query(100, ge=1, le=500),
    offset: int = Query(0, ge=0),
    ...
):
    logs = query.order_by(...).offset(offset).limit(limit).all()
    return [_enrich_audit_response(log, db) for log in logs]

# Analog für alle anderen unlimitierten Listen-Endpunkte anwenden.</pre>
      </div>
    </div>
  </div>

  <!-- ─── VULN-006 ─────────────────────────────────── -->
  <div class="finding" id="vuln-006">
    <div class="finding-header medium">
      <div>
        <div class="finding-id">VULN-006</div>
        <div class="finding-title">Inkonsistente Passwort-Mindestlängen-Validierung im Frontend</div>
        <div style="margin-top:6px; display:flex; gap:8px; flex-wrap:wrap;">
          <span class="badge badge-medium">Mittel</span>
          <span style="font-size:.8rem;color:var(--muted);">CVSS 5.0 | CWE-521 | A07:2021</span>
        </div>
      </div>
    </div>
    <div class="finding-body">
      <div class="field">
        <div class="field-label">Betroffene Datei</div>
        <div class="field-value"><code>frontend/src/pages/Profile.tsx</code></div>
      </div>
      <div class="field">
        <div class="field-label">Technische Beschreibung</div>
        <div class="field-value">
          <p>Das Backend (<code>schemas/user.py</code>) setzt für Passwörter eine Mindestlänge von <strong>10 Zeichen</strong> + Komplexitätsanforderungen durch. Die Profilseite (<code>Profile.tsx</code>) prüft jedoch nur 8 Zeichen:</p>
        </div>
      </div>
      <div class="field">
        <div class="field-label">Betroffener Code</div>
        <pre>
// Profile.tsx – Zeile 53 (Client-seitige Validierung)
if (passwordData.new_password.length &lt; 8) {   // ← Falsch: sollte 10 sein
    setError('Passwort muss mindestens 8 Zeichen lang sein');
    return;
}
// Die Meldung "mindestens 8 Zeichen" widerspricht der Backend-Anforderung (10 Zeichen)</pre>
        <p style="margin-top:8px;">Das Backend lehnt 8-9-Zeichen-Passwörter mit einem 422-Fehler ab. Die UI zeigt aber eine irreführende Fehlermeldung ("8 Zeichen genügen") und versucht dann den API-Call, der mit einer kryptischen Backend-Fehlermeldung scheitert.</p>
        <p style="margin-top:8px;">Außerdem fehlt die clientseitige Überprüfung von Groß-/Kleinbuchstaben und Ziffern, was zu einer schlechten UX führt (Benutzer sieht erst nach dem Submit-Versuch den echten Fehler).</p>
      </div>
      <div class="field">
        <div class="field-label">Impact</div>
        <div class="field-value">Verwirrende Benutzerführung; Benutzer könnten glauben, kurze Passwörter seien akzeptiert. Potentiell werden schwächere Passwörter als vom Backend erlaubt versucht, was aber korrekt abgelehnt wird. Kein direktes Sicherheitsproblem, aber schlechte Defense-in-Depth.</div>
      </div>
      <div class="field">
        <div class="field-label">Empfehlung</div>
        <pre>
// Profile.tsx – Validierung angleichen
const validatePassword = (pwd: string): string | null => {
    if (pwd.length &lt; 10) return 'Passwort muss mindestens 10 Zeichen lang sein';
    if (!/[A-Z]/.test(pwd)) return 'Mindestens ein Großbuchstabe erforderlich';
    if (!/[a-z]/.test(pwd)) return 'Mindestens ein Kleinbuchstabe erforderlich';
    if (!/[0-9]/.test(pwd)) return 'Mindestens eine Ziffer erforderlich';
    return null;
};
// Analog im Passwort-Hinweistext: "mindestens 8 Zeichen" → "mindestens 10 Zeichen"</pre>
      </div>
    </div>
  </div>

  <!-- ─── VULN-007 ─────────────────────────────────── -->
  <div class="finding" id="vuln-007">
    <div class="finding-header medium">
      <div>
        <div class="finding-id">VULN-007</div>
        <div class="finding-title">Fehlender HSTS-Header im Standard-HTTP-Deployment</div>
        <div style="margin-top:6px; display:flex; gap:8px; flex-wrap:wrap;">
          <span class="badge badge-medium">Mittel</span>
          <span style="font-size:.8rem;color:var(--muted);">CVSS 5.4 | CWE-319 | A05:2021</span>
        </div>
      </div>
    </div>
    <div class="finding-body">
      <div class="field">
        <div class="field-label">Betroffene Datei</div>
        <div class="field-value"><code>frontend/nginx.conf</code></div>
      </div>
      <div class="field">
        <div class="field-label">Technische Beschreibung</div>
        <div class="field-value">
          <p>Die nginx.conf enthält einen guten Security-Header-Block, aber kein <code>Strict-Transport-Security</code> (HSTS). Das Standard-Deployment läuft auf HTTP (Port 80). Die HTTPS-Konfiguration ist auskommentiert und als "Template" markiert.</p>
          <p>In der Praxis wird die Anwendung häufig in einem LAN oder hinter einem Reverse-Proxy betrieben, aber:</p>
          <ul style="margin: 10px 0 10px 24px;">
            <li>Ohne HTTPS/HSTS werden JWT-Tokens und Session-Daten im Klartext übertragen.</li>
            <li>Das <code>COOKIE_SECURE</code>-Flag ist standardmäßig <code>False</code> (<code>config.py</code> Zeile 24).</li>
            <li>Durch die Kombination können Angreifer im gleichen Netzwerk MitM-Angriffe durchführen.</li>
          </ul>
          <p>Die HSTS-Konfiguration ist nur im auskommentierten SSL-Block vorhanden, nicht im aktiven HTTP-Block.</p>
        </div>
      </div>
      <div class="field">
        <div class="field-label">Angriffsszenario</div>
        <div class="field-value">In einer Arztpraxis-Umgebung mit gemeinsamem WLAN: Ein Angreifer im gleichen Netzwerk führt einen ARP-Spoofing-Angriff durch und fängt JWTs ab. Diese können sofort für 30 Minuten für alle API-Zugriffe verwendet werden.</div>
      </div>
      <div class="field">
        <div class="field-label">Empfehlung</div>
        <pre>
# nginx.conf – Im HTTP-Block ergänzen (als explizite Warnung, wenn kein HTTPS):
# Wenn die App über HTTPS betrieben wird (empfohlen!), HSTS aktivieren:

# Im SSL-Block (nach Aktivierung):
add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;

# In .env.example als Pflichthinweis:
# COOKIE_SECURE=true    # IMMER in Produktion mit HTTPS!
# COOKIE_SAMESITE=strict  # Strengste Einstellung bei Same-Origin-Apps</pre>
        <p style="margin-top:10px;">HTTPS sollte als zwingende Voraussetzung für den Produktivbetrieb dokumentiert werden, nicht als optionales Feature.</p>
      </div>
    </div>
  </div>

  <!-- ─── VULN-008 ─────────────────────────────────── -->
  <div class="finding" id="vuln-008">
    <div class="finding-header medium">
      <div>
        <div class="finding-id">VULN-008</div>
        <div class="finding-title">Grafana WebSocket-Proxy ohne IP-Beschränkung exponiert</div>
        <div style="margin-top:6px; display:flex; gap:8px; flex-wrap:wrap;">
          <span class="badge badge-medium">Mittel</span>
          <span style="font-size:.8rem;color:var(--muted);">CVSS 5.3 | CWE-284 | A01:2021</span>
        </div>
      </div>
    </div>
    <div class="finding-body">
      <div class="field">
        <div class="field-label">Betroffene Datei</div>
        <div class="field-value"><code>frontend/nginx.conf</code>, Zeilen 63–70</div>
      </div>
      <div class="field">
        <div class="field-label">Technische Beschreibung</div>
        <div class="field-value">
          <p>Der Grafana-Hauptbereich (<code>/grafana/</code>) ist korrekt auf private IP-Bereiche beschränkt. Die WebSocket-Route für Grafana Live (<code>/grafana/api/live/</code>) fehlt diese IP-Einschränkung:</p>
        </div>
      </div>
      <div class="field">
        <div class="field-label">Betroffener Code</div>
        <pre>
# nginx.conf – Zeilen 48-70
location /grafana/ {
    allow 10.0.0.0/8;      # ✓ IP-Whitelist vorhanden
    allow 192.168.0.0/16;
    allow 172.16.0.0/12;
    allow 127.0.0.1;
    deny all;
    proxy_pass http://grafana:3000/grafana/;
    ...
}

location /grafana/api/live/ {  # ← KEIN IP-Filter!
    proxy_pass http://grafana:3000/grafana/api/live/;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    ...
}</pre>
      </div>
      <div class="field">
        <div class="field-label">Impact</div>
        <div class="field-value">Externe Angreifer können potenziell die Grafana Live-Streaming-API direkt ansprechen. Je nach Grafana-Version können hierüber Metriken und Dashboarddaten ohne vorheriges Login abgerufen werden. Grafana-WebSocket-Verbindungen sind in einigen Versionen anfällig für SSRF-ähnliche Angriffe.</div>
      </div>
      <div class="field">
        <div class="field-label">Empfehlung</div>
        <pre>
# nginx.conf – IP-Whitelist auf WebSocket-Route anwenden
location /grafana/api/live/ {
    allow 10.0.0.0/8;       # ← HINZUFÜGEN
    allow 192.168.0.0/16;   # ← HINZUFÜGEN
    allow 172.16.0.0/12;    # ← HINZUFÜGEN
    allow 127.0.0.1;        # ← HINZUFÜGEN
    deny all;               # ← HINZUFÜGEN

    proxy_pass http://grafana:3000/grafana/api/live/;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    proxy_set_header Host $host;
}</pre>
      </div>
    </div>
  </div>

  <!-- ─── VULN-009 ─────────────────────────────────── -->
  <div class="finding" id="vuln-009">
    <div class="finding-header medium">
      <div>
        <div class="finding-id">VULN-009</div>
        <div class="finding-title">Race Condition beim gleichzeitigen Clock-In (doppelter Einstempel-Eintrag möglich)</div>
        <div style="margin-top:6px; display:flex; gap:8px; flex-wrap:wrap;">
          <span class="badge badge-medium">Mittel</span>
          <span style="font-size:.8rem;color:var(--muted);">CVSS 4.8 | CWE-362 | A04:2021</span>
        </div>
      </div>
    </div>
    <div class="finding-body">
      <div class="field">
        <div class="field-label">Betroffener Code</div>
        <div class="field-value"><code>backend/app/routers/time_entries.py</code>, <code>clock_in()</code>-Funktion (Zeilen 188–223)</div>
      </div>
      <div class="field">
        <div class="field-label">Technische Beschreibung</div>
        <div class="field-value">
          <p>Die <code>clock_in</code>-Funktion prüft zunächst auf einen offenen Eintrag (<code>_get_open_entry</code>) und erstellt dann einen neuen. Zwischen diesen zwei Operationen gibt es kein Datenbank-Level-Lock:</p>
        </div>
      </div>
      <div class="field">
        <div class="field-label">Race-Condition-Sequenz</div>
        <pre>
# Thread A                         # Thread B (selbe User-Session, z.B. PWA + Browser)
open_entry = _get_open_entry()     open_entry = _get_open_entry()
# → None (kein offener Eintrag)    # → None (kein offener Eintrag)
entry = TimeEntry(...)             entry = TimeEntry(...)
db.add(entry)                      db.add(entry)
db.commit()                        db.commit()
# → Eintrag A erstellt!            # → Eintrag B erstellt! (Race!)
# Resultat: 2 offene Einträge ohne end_time für denselben User</pre>
        <p style="margin-top:10px;">Zwar verhindert der UniqueConstraint <code>uq_user_date_start</code> auf <code>(user_id, date, start_time)</code> exakt gleiche Startzeiten, aber bei minimal unterschiedlichen Millisekunden-Timestamps (abgerundet auf Minuten mit <code>replace(second=0, microsecond=0)</code>) können zwei Einträge mit der gleichen Startzeit trotzdem durch das Runden kollisionsfrei entstehen, oder bei sehr schnellen parallelen Requests (innerhalb derselben Minute) kommt es zur DB-Constraint-Verletzung.</p>
      </div>
      <div class="field">
        <div class="field-label">Impact</div>
        <div class="field-value">Doppelte Zeiteinträge verfälschen die Arbeitszeitabrechnung. Der <code>_get_open_entry</code>-Check liefert dann inkonsistente Ergebnisse. Clock-Out würde nur einen der beiden Einträge schließen.</div>
      </div>
      <div class="field">
        <div class="field-label">Empfehlung</div>
        <pre>
# time_entries.py – clock_in mit SELECT FOR UPDATE absichern
from sqlalchemy import select
from sqlalchemy.orm import Session

def clock_in(...):
    # Pessimistisches Locking: verhindert Race Condition
    with db.begin_nested():
        open_entry = (
            db.execute(
                select(TimeEntry)
                .filter(
                    TimeEntry.user_id == current_user.id,
                    TimeEntry.end_time.is_(None)
                )
                .with_for_update()   # ← HINZUFÜGEN
            )
            .scalars()
            .first()
        )
        if open_entry:
            raise HTTPException(400, "Bereits eingestempelt")
        entry = TimeEntry(...)
        db.add(entry)
    db.commit()</pre>
      </div>
    </div>
  </div>

  <!-- ─── VULN-010 ─────────────────────────────────── -->
  <div class="finding" id="vuln-010">
    <div class="finding-header medium">
      <div>
        <div class="finding-id">VULN-010</div>
        <div class="finding-title">Rollenwechsel via PUT /admin/users/{id} invalidiert keine existierenden Tokens</div>
        <div style="margin-top:6px; display:flex; gap:8px; flex-wrap:wrap;">
          <span class="badge badge-medium">Mittel</span>
          <span style="font-size:.8rem;color:var(--muted);">CVSS 4.9 | CWE-269 | A01:2021</span>
        </div>
      </div>
    </div>
    <div class="finding-body">
      <div class="field">
        <div class="field-label">Betroffener Code</div>
        <div class="field-value"><code>backend/app/routers/admin.py</code>, <code>update_user()</code>-Funktion (Zeilen 284–307)</div>
      </div>
      <div class="field">
        <div class="field-label">Technische Beschreibung</div>
        <div class="field-value">
          <p>Wenn ein Administrator die Rolle eines Benutzers ändert (z.B. von <code>employee</code> zu <code>admin</code> oder umgekehrt), werden die existierenden JWTs des Benutzers nicht invalidiert. Die Rolle ist im JWT-Claim (<code>"role"</code>) kodiert und wird beim nächsten Request aus dem Token gelesen – nicht aus der DB.</p>
        </div>
      </div>
      <div class="field">
        <div class="field-label">Betroffener Code</div>
        <pre>
# admin.py – update_user (Zeilen 301-307)
update_data = user_data.model_dump(exclude_unset=True)
for field, value in update_data.items():
    setattr(user, field, value)   # Kann "role" setzen!

db.commit()
db.refresh(user)
return user
# ← KEIN user.token_version += 1 nach Rollenänderung!</pre>
        <p style="margin-top:10px;">Konkretes Szenario: Benutzer A wird zum Admin befördert. Sein alter Token hat <code>role=employee</code>. Er authentifiziert sich neu und erhält einen Token mit <code>role=admin</code>. Falls sein alter Token (Ablauf: 30 Minuten) noch gültig ist, hat er während dieser Zeit sowohl Admin- als auch Employee-Token – was bei parallelen Sessions (Browser + Mobilgerät) zu Inkonsistenzen führt. Umgekehrt: Ein depromovierter Admin behält Admin-Rechte bis zu 30 Minuten nach der Rollenänderung.</p>
      </div>
      <div class="field">
        <div class="field-label">Impact</div>
        <div class="field-value">Ein abgesetzter Admin behält bis zu 30 Minuten Admin-Zugriff. Bei Insider-Bedrohungen ist dies ein kritisches Zeitfenster.</div>
      </div>
      <div class="field">
        <div class="field-label">Empfehlung</div>
        <pre>
# admin.py – update_user: Bei Rollenänderung token_version erhöhen
update_data = user_data.model_dump(exclude_unset=True)
role_changed = 'role' in update_data and update_data['role'] != user.role
is_active_changed = 'is_active' in update_data and update_data['is_active'] != user.is_active

for field, value in update_data.items():
    setattr(user, field, value)

if role_changed or is_active_changed:
    user.token_version = (user.token_version or 0) + 1  # ← HINZUFÜGEN

db.commit()
db.refresh(user)
return user</pre>
      </div>
    </div>
  </div>

  <!-- ─── VULN-011 ─────────────────────────────────── -->
  <div class="finding" id="vuln-011">
    <div class="finding-header medium">
      <div>
        <div class="finding-id">VULN-011</div>
        <div class="finding-title">Business Logic: Urlaubsüberzug wird berechnet, aber nicht blockiert</div>
        <div style="margin-top:6px; display:flex; gap:8px; flex-wrap:wrap;">
          <span class="badge badge-medium">Mittel</span>
          <span style="font-size:.8rem;color:var(--muted);">CVSS 4.3 | CWE-840 | A04:2021</span>
        </div>
      </div>
    </div>
    <div class="finding-body">
      <div class="field">
        <div class="field-label">Betroffener Code</div>
        <div class="field-value"><code>backend/app/routers/absences.py</code>, <code>create_absence()</code> (Zeilen 239–245)</div>
      </div>
      <div class="field">
        <div class="field-label">Technische Beschreibung</div>
        <div class="field-value">
          <p>Die <code>create_absence</code>-Route berechnet das verbleibende Urlaubsguthaben, unternimmt aber nichts wenn dieses unterschritten wird:</p>
        </div>
      </div>
      <div class="field">
        <div class="field-label">Betroffener Code</div>
        <pre>
# absences.py – Zeilen 239-245
if absence_data.type == AbsenceType.VACATION:
    vacation_account = calculation_service.get_vacation_account(
        db, target_user, start_date.year
    )
    total_hours_needed = Decimal(str(absence_data.hours)) * len(dates_to_create)
    new_remaining = vacation_account['remaining_hours'] - total_hours_needed
    # ← KEIN Check ob new_remaining &lt; 0!
    # ← KEINE HTTPException wird geworfen!
    # ← Urlaub wird unbegrenzt angelegt</pre>
        <p style="margin-top:10px;">Der Code berechnet <code>new_remaining</code>, speichert das Ergebnis aber nicht und prüft nicht ob es negativ ist. Dies erlaubt es Mitarbeitern oder Admins, beliebig viele Urlaubstage einzutragen, auch weit über das Budget hinaus.</p>
      </div>
      <div class="field">
        <div class="field-label">Angriffsszenario</div>
        <div class="field-value">Ein Mitarbeiter beantragt über die API oder das Frontend 200 Urlaubstage, obwohl er nur 30 hat. Das System bucht alle ein. Erst beim Report fällt der Überzug auf – zu diesem Zeitpunkt ist der Urlaub möglicherweise bereits gewährt.</div>
      </div>
      <div class="field">
        <div class="field-label">Impact</div>
        <div class="field-value">Manipulation der Urlaubsabrechnung; potentieller finanzieller Schaden für die Praxis; DSGVO-Compliance-Probleme bei Falschberichten nach §16 ArbZG.</div>
      </div>
      <div class="field">
        <div class="field-label">Empfehlung</div>
        <pre>
# absences.py – Urlaubsüberschuss blockieren
if absence_data.type == AbsenceType.VACATION:
    vacation_account = calculation_service.get_vacation_account(
        db, target_user, start_date.year
    )
    total_hours_needed = Decimal(str(absence_data.hours)) * len(dates_to_create)
    new_remaining = vacation_account['remaining_hours'] - total_hours_needed

    # ← HINZUFÜGEN: Prüfung ob Urlaubskonto ausreicht
    if new_remaining &lt; 0:
        raise HTTPException(
            status_code=422,
            detail=f"Urlaubskonto reicht nicht aus. Verfügbar: "
                   f"{float(vacation_account['remaining_hours']):.1f}h, "
                   f"Benötigt: {float(total_hours_needed):.1f}h. "
                   f"Bitte mit Administrator klären."
        )</pre>
        <p style="margin-top:10px;">Alternativ: Admin-Override-Flag in der Request erlauben, der die Prüfung überspringt (für bewussten Überzug).</p>
      </div>
    </div>
  </div>

  <!-- ─── VULN-012 ─────────────────────────────────── -->
  <div class="finding" id="vuln-012">
    <div class="finding-header medium">
      <div>
        <div class="finding-id">VULN-012</div>
        <div class="finding-title">Vollständige Fehlermeldungen (Tracebacks) in Datenbank gespeichert und Admin exponiert</div>
        <div style="margin-top:6px; display:flex; gap:8px; flex-wrap:wrap;">
          <span class="badge badge-medium">Mittel</span>
          <span style="font-size:.8rem;color:var(--muted);">CVSS 4.3 | CWE-209 | A09:2021</span>
        </div>
      </div>
    </div>
    <div class="finding-body">
      <div class="field">
        <div class="field-label">Betroffene Dateien</div>
        <div class="field-value"><code>backend/app/services/error_log_service.py</code>, <code>backend/app/routers/error_logs.py</code></div>
      </div>
      <div class="field">
        <div class="field-label">Technische Beschreibung</div>
        <div class="field-value">
          <p>Die Anwendung speichert vollständige Python-Stack-Traces in der <code>error_logs</code>-Tabelle und gibt diese über die Admin-API zurück. Stack-Traces enthalten:</p>
          <ul style="margin: 10px 0 10px 24px;">
            <li>Vollständige Dateipfade auf dem Server (z.B. <code>/app/routers/time_entries.py</code>)</li>
            <li>Variablennamen und Werte aus dem Stack-Frame</li>
            <li>Potenziell interne IP-Adressen oder Konfigurationswerte in Ausnahmen</li>
            <li>Bibliotheksinterne Pfade (SQLAlchemy, FastAPI)</li>
          </ul>
          <p>Die PII-Bereinigung (<code>_scrub_pii</code>) entfernt nur UUIDs und E-Mail-Adressen, aber keine technischen Pfade oder Datenbankverbindungs-Strings die gelegentlich in SQLAlchemy-Exceptions erscheinen.</p>
          <p>Zudem wird die GitHub-Issue-URL unvalidiert aus der DB zurückgegeben (nur beim Setzen validiert, beim Lesen nicht); ein Angreifer der eine SQL-Injection in der Error-Tabelle (unwahrscheinlich, aber theoretisch) durchführen könnte, könnte beliebige URLs einschleusen.</p>
        </div>
      </div>
      <div class="field">
        <div class="field-label">Impact</div>
        <div class="field-value">Information Disclosure gegenüber Admin-Benutzern (niedrige Priorität, da bereits Admin-Zugriff erforderlich). Bei einer Privilege-Escalation-Kette jedoch wertvolle Informationen für weitere Angriffe.</div>
      </div>
      <div class="field">
        <div class="field-label">Empfehlung</div>
        <pre>
# error_log_service.py – _scrub_pii() erweitern
_FILE_PATH_RE = re.compile(r'(?:File|in) "(/[^"]+)"')
_CONN_STR_RE = re.compile(r'postgresql://[^@]+@[^\s]+')

def _scrub_pii(text: str) -> str:
    if not text:
        return text
    text = _UUID_RE.sub('&lt;uuid&gt;', text)
    text = _EMAIL_RE.sub('&lt;email&gt;', text)
    text = _FILE_PATH_RE.sub('File "&lt;path&gt;"', text)   # ← HINZUFÜGEN
    text = _CONN_STR_RE.sub('&lt;db-connection&gt;', text) # ← HINZUFÜGEN
    return text</pre>
      </div>
    </div>
  </div>

  <!-- ─── VULN-013 ─────────────────────────────────── -->
  <div class="finding" id="vuln-013">
    <div class="finding-header low">
      <div>
        <div class="finding-id">VULN-013</div>
        <div class="finding-title">Fehlende server_tokens-Direktive in Nginx (Versionsangabe in Error-Pages)</div>
        <div style="margin-top:6px; display:flex; gap:8px; flex-wrap:wrap;">
          <span class="badge badge-low">Niedrig</span>
          <span style="font-size:.8rem;color:var(--muted);">CVSS 3.1 | CWE-200 | A05:2021</span>
        </div>
      </div>
    </div>
    <div class="finding-body">
      <div class="field">
        <div class="field-label">Betroffene Datei</div>
        <div class="field-value"><code>frontend/nginx.conf</code></div>
      </div>
      <div class="field">
        <div class="field-label">Technische Beschreibung</div>
        <div class="field-value">
          <p>Die nginx.conf enthält keine <code>server_tokens off;</code>-Direktive. Nginx sendet standardmäßig seine Version in Error-Pages und im <code>Server</code>-HTTP-Header. Angreifer können die Nginx-Version für gezielte CVE-Suche nutzen.</p>
        </div>
      </div>
      <div class="field">
        <div class="field-label">Empfehlung</div>
        <pre>
# nginx.conf – Im server{}-Block hinzufügen:
server_tokens off;   # ← HINZUFÜGEN (versteckt Nginx-Version)</pre>
      </div>
    </div>
  </div>

  <!-- ─── VULN-014 ─────────────────────────────────── -->
  <div class="finding" id="vuln-014">
    <div class="finding-header low">
      <div>
        <div class="finding-id">VULN-014</div>
        <div class="finding-title">Dependency-Versionen als Wildcards ohne SHA-Pinning</div>
        <div style="margin-top:6px; display:flex; gap:8px; flex-wrap:wrap;">
          <span class="badge badge-low">Niedrig</span>
          <span style="font-size:.8rem;color:var(--muted);">CVSS 3.7 | CWE-1357 | A06:2021</span>
        </div>
      </div>
    </div>
    <div class="finding-body">
      <div class="field">
        <div class="field-label">Betroffene Datei</div>
        <div class="field-value"><code>backend/requirements.txt</code></div>
      </div>
      <div class="field">
        <div class="field-label">Technische Beschreibung</div>
        <div class="field-value">
          <p>Alle Abhängigkeiten sind mit Wildcards (<code>==0.115.*</code>, <code>==2.0.*</code> usw.) angegeben. Dies erlaubt Patch-Versionen automatisch zu installieren, was grundsätzlich gut für Sicherheits-Patches ist, aber bei einem Supply-Chain-Angriff (kompromittiertes PyPI-Paket) Schaden verursachen könnte.</p>
          <ul style="margin: 10px 0 10px 24px;">
            <li><code>passlib[bcrypt]==1.7.*</code> – passlib hat seit 1.7.4 keine Wartung mehr (letztes Release 2020). Bei bcrypt-Kompatibilität mit Python 3.12 gibt es bekannte Warnungen.</li>
            <li><code>bcrypt==4.0.*</code> – Erlaubt 4.0.x bis 4.0.∞; passlib 1.7.x hat bekannte Kompatibilitätsprobleme mit bcrypt >= 4.0.0</li>
            <li><code>workalendar==17.*</code> – Veraltete Bibliothek (letztes Release 2022, in Archivmodus)</li>
          </ul>
        </div>
      </div>
      <div class="field">
        <div class="field-label">Empfehlung</div>
        <pre>
# Kritische Pakete pinnen:
# pip-compile (pip-tools) zum Erzeugen einer requirements.lock verwenden:
pip-compile --generate-hashes requirements.in &gt; requirements.txt

# passlib wird nicht mehr gewartet; Migration zu modernem Ansatz:
# Option 1: argon2-cffi statt bcrypt (empfohlen für neue Deployments)
# Option 2: Bcrypt direkt ohne passlib verwenden (bcrypt-Paket)

# workalendar: Prüfen ob holidays-Paket (aktiv gewartet) als Ersatz geeignet</pre>
      </div>
    </div>
  </div>

  <!-- ─── VULN-015 ─────────────────────────────────── -->
  <div class="finding" id="vuln-015">
    <div class="finding-header info">
      <div>
        <div class="finding-id">VULN-015</div>
        <div class="finding-title">Admin-Passwort beim initialen Setup unterliegt keiner Komplexitätsprüfung</div>
        <div style="margin-top:6px; display:flex; gap:8px; flex-wrap:wrap;">
          <span class="badge badge-info">Informativ</span>
          <span style="font-size:.8rem;color:var(--muted);">CVSS 2.1 | CWE-521 | A07:2021</span>
        </div>
      </div>
    </div>
    <div class="finding-body">
      <div class="field">
        <div class="field-label">Betroffener Code</div>
        <div class="field-value"><code>backend/app/main.py</code>, <code>lifespan()</code>-Funktion (Zeilen 46–59)</div>
      </div>
      <div class="field">
        <div class="field-label">Technische Beschreibung</div>
        <div class="field-value">
          <p>Beim ersten Start erstellt <code>lifespan()</code> den Admin-User mit dem Passwort aus <code>settings.ADMIN_PASSWORD</code>. Dieses Passwort wird mit <code>auth_service.hash_password()</code> gehasht, aber <em>nicht</em> mit der gleichen <code>_validate_password_complexity()</code>-Funktion validiert, die für reguläre Passworterstellung gilt.</p>
          <p>Es gibt einen Post-hoc-Check (Zeilen 65–71), der eine Warnung ausgibt, wenn das Admin-Passwort schwach ist. Dieser Check prüft jedoch nur bestimmte bekannte schwache Passwörter (<code>["Admin2025!", ...]</code>) und Mindestlänge &lt; 12 Zeichen – nicht die vollständigen Komplexitätsanforderungen.</p>
          <p>Das in der <code>.env</code> verwendete <code>Admin2025!</code> ist in der Whitelist der "weak passwords" und löst korrekt eine Warnung aus. Diese ist aber nur im Log sichtbar, nicht als Startup-Fehler (kein <code>sys.exit</code>).</p>
        </div>
      </div>
      <div class="field">
        <div class="field-label">Empfehlung</div>
        <div class="field-value">
          <p>Die Startup-Warnung reicht aus, aber sollte in Produktion (<code>ENVIRONMENT=production</code>) zu einem <code>sys.exit(1)</code> eskaliert werden wenn das Admin-Passwort schwach oder im Default-Format ist. Dies verhindert einen Produktivstart mit schwachen Credentials.</p>
        </div>
      </div>
    </div>
  </div>

</section>

<!-- ═══════════════════════════════════════════════════
     5. ANGRIFFSKETTEN
════════════════════════════════════════════════════ -->
<section id="attack-chains">
  <h2>5. Angriffsketten-Analyse</h2>

  <div style="background:var(--surface); border:1px solid var(--border); border-radius:12px; padding:20px; margin-bottom:20px;">
    <h3 style="color:var(--critical); margin-top:0;">Kette A: Credential-Leak → Vollständige Kompromittierung</h3>
    <p style="margin: 10px 0;"><strong>VULN-010</strong> (Keine Token-Invalidierung bei Rollen-Wechsel) + <strong>VULN-002</strong> (Kein TOTP-Rate-Limiting)</p>
    <ol style="margin-left:24px; line-height:2.2;">
      <li>Angreifer kompromittiert einen Benutzeraccount</li>
      <li>Umgeht TOTP via Brute-Force (VULN-002)</li>
      <li>Erstellt neuen Admin-Account mit bekanntem Passwort</li>
      <li>Ändert Rollen beliebiger Mitarbeiter; alte Tokens bleiben 30 Minuten gültig (VULN-010)</li>
      <li>Exfiltriert alle Mitarbeiterdaten via Admin-Reports (Zeiteinträge, Krankmeldungen)</li>
    </ol>
    <p style="margin-top:10px; color:var(--critical);"><strong>Gesamtrisiko: Kritisch</strong></p>
  </div>

  <div style="background:var(--surface); border:1px solid var(--border); border-radius:12px; padding:20px; margin-bottom:20px;">
    <h3 style="color:var(--high); margin-top:0;">Kette B: XSS → Token-Diebstahl → Account-Takeover</h3>
    <p style="margin: 10px 0;"><strong>VULN-004</strong> (refresh_token in localStorage) + hypothetisches XSS (z.B. via Drittanbieter-Content)</p>
    <ol style="margin-left:24px; line-height:2.2;">
      <li>XSS-Payload exfiltriert <code>localStorage.getItem('refresh_token')</code></li>
      <li>Angreifer nutzt gestohlenen Refresh-Token für 7 Tage neue Access-Tokens</li>
      <li>Greift auf alle Mitarbeiter-Zeitdaten zu, manipuliert Einträge</li>
    </ol>
    <p style="margin-top:10px; color:var(--high);"><strong>Gesamtrisiko: Hoch</strong></p>
  </div>

  <div style="background:var(--surface); border:1px solid var(--border); border-radius:12px; padding:20px;">
    <h3 style="color:var(--medium); margin-top:0;">Kette C: Mitarbeiter-Eskalation → Urlaubsmanipulation</h3>
    <p style="margin: 10px 0;"><strong>VULN-011</strong> (Urlaubsüberzug) + legitimer API-Zugriff</p>
    <ol style="margin-left:24px; line-height:2.2;">
      <li>Mitarbeiter beantragt 100 Urlaubstage über die API</li>
      <li>System bucht alle ein (kein Limit)</li>
      <li>Manipulation erst beim nächsten Monatsbericht sichtbar</li>
    </ol>
    <p style="margin-top:10px; color:var(--medium);"><strong>Gesamtrisiko: Mittel</strong></p>
  </div>
</section>

<!-- ═══════════════════════════════════════════════════
     6. REMEDIATION-ROADMAP
════════════════════════════════════════════════════ -->
<section id="roadmap">
  <h2>6. Remediation-Roadmap</h2>

  <h3>Phase 1 – Sofortmaßnahmen (innerhalb 24 Stunden)</h3>
  <div class="roadmap-item"><div class="roadmap-phase p1">1</div><div><strong>VULN-002:</strong> Rate-Limiting auf alle TOTP-Endpunkte anwenden (3 Zeilen Code).</div></div>
  <div class="roadmap-item"><div class="roadmap-phase p1">1</div><div><strong>VULN-010:</strong> Token-Invalidierung bei Rollen-Wechsel implementieren (<code>token_version</code> inkrementieren).</div></div>

  <h3>Phase 2 – Kurzfristige Fixes (innerhalb 1 Woche)</h3>
  <div class="roadmap-item"><div class="roadmap-phase p2">2</div><div><strong>VULN-002:</strong> Rate-Limiting auf alle TOTP-Endpunkte anwenden (3 Zeilen Code).</div></div>
  <div class="roadmap-item"><div class="roadmap-phase p2">2</div><div><strong>VULN-004:</strong> <code>refresh_token</code> aus <code>localStorage</code> entfernen. Frontend-Refresh-Logik auf Cookie-basiert umstellen.</div></div>
  <div class="roadmap-item"><div class="roadmap-phase p2">2</div><div><strong>VULN-008:</strong> IP-Whitelist auf Grafana WebSocket-Route übertragen (5 Zeilen nginx.conf).</div></div>
  <div class="roadmap-item"><div class="roadmap-phase p2">2</div><div><strong>VULN-010:</strong> <code>token_version</code> inkrementieren wenn Rolle oder is_active geändert wird.</div></div>
  <div class="roadmap-item"><div class="roadmap-phase p2">2</div><div><strong>VULN-011:</strong> Urlaubsüberzugs-Check implementieren (10 Zeilen Code).</div></div>
  <div class="roadmap-item"><div class="roadmap-phase p2">2</div><div><strong>VULN-006:</strong> Frontend-Passwortvalidierung auf 10 Zeichen + Komplexität angleichen.</div></div>

  <h3>Phase 3 – Mittelfristige Verbesserungen (innerhalb 1 Monat)</h3>
  <div class="roadmap-item"><div class="roadmap-phase p3">3</div><div><strong>VULN-003:</strong> TOTP-Secret in DB verschlüsselt speichern; PII-Scrubber um Base32-Strings erweitern.</div></div>
  <div class="roadmap-item"><div class="roadmap-phase p3">3</div><div><strong>VULN-005:</strong> Paginierung auf alle ungebundenen Listen-Endpunkte anwenden.</div></div>
  <div class="roadmap-item"><div class="roadmap-phase p3">3</div><div><strong>VULN-007:</strong> HTTPS als verpflichtend dokumentieren; HSTS-Header aktivieren; COOKIE_SECURE=true für Produktion erzwingen.</div></div>
  <div class="roadmap-item"><div class="roadmap-phase p3">3</div><div><strong>VULN-009:</strong> SELECT FOR UPDATE auf clock_in-Funktion anwenden.</div></div>
  <div class="roadmap-item"><div class="roadmap-phase p3">3</div><div><strong>VULN-012:</strong> Traceback-Bereinigung um Dateipfade und Verbindungs-Strings erweitern.</div></div>

  <h3>Phase 4 – Langfristige Optimierungen (innerhalb 3 Monate)</h3>
  <div class="roadmap-item"><div class="roadmap-phase p4">4</div><div><strong>VULN-013:</strong> <code>server_tokens off;</code> in nginx.conf hinzufügen.</div></div>
  <div class="roadmap-item"><div class="roadmap-phase p4">4</div><div><strong>VULN-014:</strong> pip-tools für SHA-gepinnte Requirements verwenden; passlib-Migration evaluieren.</div></div>
  <div class="roadmap-item"><div class="roadmap-phase p4">4</div><div><strong>VULN-015:</strong> Startup-Warnung bei schwachem Admin-Passwort in Produktion zu sys.exit() eskalieren.</div></div>
  <div class="roadmap-item"><div class="roadmap-phase p4">4</div><div>Secrets-Management-Lösung evaluieren (Docker Secrets, HashiCorp Vault oder äquivalent).</div></div>
  <div class="roadmap-item"><div class="roadmap-phase p4">4</div><div>gitleaks oder ähnliches als Pre-Commit-Hook einrichten.</div></div>
</section>

<!-- ═══════════════════════════════════════════════════
     7. POSITIVE SECURITY CONTROLS
════════════════════════════════════════════════════ -->
<section id="positives">
  <h2>7. Positive Security Controls</h2>
  <div class="callout callout-good">Diese Kontrollen wurden als korrekt implementiert befunden und sollten beibehalten werden.</div>

  <div style="margin-top:20px;">
    <div class="positive-item"><div class="check">✓</div><div><strong>JWT Token-Revocation via token_version:</strong> Implementiert und funktional für Passwortänderung, Logout und User-Deaktivierung. Solide Implementierung.</div></div>
    <div class="positive-item"><div class="check">✓</div><div><strong>HttpOnly-Cookie für Refresh-Token:</strong> Backend korrekt auf Cookie-Delivery umgestellt (F-010). Schützt vor XSS-basierten Token-Diebstählen.</div></div>
    <div class="positive-item"><div class="check">✓</div><div><strong>TOTP/2FA-Implementierung:</strong> Korrekte pyotp-Nutzung, ±1-Window-Toleranz, Setup-Verify-zwei-Phasen-Prozess, Passwort-Bestätigung beim Deaktivieren.</div></div>
    <div class="positive-item"><div class="check">✓</div><div><strong>Bcrypt für Passwort-Hashing:</strong> Korrekte Verwendung mit passlib, 72-Byte-Truncation explizit dokumentiert und umgesetzt.</div></div>
    <div class="positive-item"><div class="check">✓</div><div><strong>Rate-Limiting auf Auth-Endpunkten:</strong> Login 5/min, Refresh 10/min, Passwortänderung 3/min. Korrekt mit slowapi implementiert.</div></div>
    <div class="positive-item"><div class="check">✓</div><div><strong>SECRET_KEY-Validierung:</strong> Startup-Validierung auf Länge und schwache Werte. Gute Defense-in-Depth.</div></div>
    <div class="positive-item"><div class="check">✓</div><div><strong>Content-Security-Policy:</strong> Strenge CSP in nginx.conf mit <code>default-src 'self'</code>, keine unsicheren Inline-Scripts. Schützt effektiv gegen XSS.</div></div>
    <div class="positive-item"><div class="check">✓</div><div><strong>Non-Root-Container:</strong> Backend läuft als <code>appuser</code> (nicht root). Korrekte Dockerfile-Implementierung.</div></div>
    <div class="positive-item"><div class="check">✓</div><div><strong>SQL-Injection-Schutz:</strong> Ausschließliche Verwendung von SQLAlchemy ORM mit parametrisierten Queries. Keine Raw-SQL-Strings mit User-Input gefunden.</div></div>
    <div class="positive-item"><div class="check">✓</div><div><strong>IDOR-Schutz auf Zeit-Einträgen:</strong> Konsistente Prüfung <code>entry.user_id != current_user.id</code> in GET, PUT, DELETE.</div></div>
    <div class="positive-item"><div class="check">✓</div><div><strong>Admin-Middleware-Dependency:</strong> <code>require_admin</code> als Router-Level-Dependency, verhindert Missing-Auth-Check-Fehler.</div></div>
    <div class="positive-item"><div class="check">✓</div><div><strong>DSGVO Art. 9 Gesundheitsdaten-Handling:</strong> Krankmeldungen standardmäßig aus Excel-Exports ausgeschlossen; Opt-In mit Audit-Log-Eintrag.</div></div>
    <div class="positive-item"><div class="check">✓</div><div><strong>PII-Bereinigung in Error-Logs:</strong> UUID- und E-Mail-Redaktion implementiert. DSGVO-konformes Logging.</div></div>
    <div class="positive-item"><div class="check">✓</div><div><strong>DSGVO-Löschfunktionen:</strong> Anonymisierung und Purge mit ArbZG-Aufbewahrungsprüfung korrekt implementiert.</div></div>
    <div class="positive-item"><div class="check">✓</div><div><strong>ArbZG-Compliance:</strong> Umfassende §3/§4/§5/§6/§9/§11/§14-Checks auf allen Eingabepfaden. Exempt-Flag für leitende Angestellte.</div></div>
    <div class="positive-item"><div class="check">✓</div><div><strong>Audit-Log für Admin-Aktionen:</strong> Zeiteintrags-Änderungen durch Admins werden vollständig mit Alt- und Neu-Werten protokolliert.</div></div>
    <div class="positive-item"><div class="check">✓</div><div><strong>CORS-Konfiguration:</strong> Keine Wildcard-Origins in Produktion, Credentials nur mit spezifischen Origins, korrekte Warnung bei Wildcard.</div></div>
    <div class="positive-item"><div class="check">✓</div><div><strong>Prometheus-Metrics-Schutz:</strong> <code>/api/metrics</code> extern durch nginx blockiert. Keine sensiblen Business-Metriken exponiert.</div></div>
    <div class="positive-item"><div class="check">✓</div><div><strong>Swagger-Deaktivierung in Produktion:</strong> Korrekte Prüfung auf <code>ENVIRONMENT=production</code>, deaktiviert /docs, /redoc, /openapi.json.</div></div>
  </div>

  <div style="margin-top:32px; padding: 20px; background:var(--surface); border-radius:12px; border:1px solid var(--border);">
    <h3 style="margin-top:0;">Abschlussbewertung</h3>
    <p>PraxisZeit zeigt eine deutliche Reifung der Sicherheitsarchitektur gegenüber dem Audit vom 2026-02-20. Die implementierten Kontrollen (Token-Revocation, HttpOnly-Cookies, TOTP, ArbZG-Compliance, DSGVO-Funktionen) sind solide und korrekt implementiert. Die verbleibenden Findings – insbesondere das Credentials-Problem in VULN-001 und die fehlenden TOTP-Rate-Limits (VULN-002) – sind behebbar und sollten priorisiert angegangen werden. Nach der Behebung aller Phase-1- und Phase-2-Findings würde die Anwendung ein für ein internes Produktionssystem akzeptables Sicherheitsniveau erreichen.</p>
  </div>
</section>

</main>
</div><!-- .two-col -->

<footer style="margin-top:48px; padding: 24px 0; border-top: 1px solid var(--border); text-align:center; color:var(--muted); font-size:.8rem;">
  PraxisZeit Security Audit Report | 2026-02-28 | Vertraulich – Nur für interne Verwendung | Alle Findings basieren auf statischer Code-Analyse und manuellem Review.
</footer>

</div><!-- .wrapper -->
</body>
</html>
